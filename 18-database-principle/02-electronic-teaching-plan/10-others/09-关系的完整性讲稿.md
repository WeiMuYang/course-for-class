## 2.3 关系的完整性     
---

- 按照数据模型的三要素，关系模型由关系数据结构，关系操作集合和关系完整性约束三部分组成 在第一节我们讲的是关系数据结构 第2节我们讲的是关系操作 下面呢，我们一起学习一下关系的完整性   

---

- 关系模型中有三类完整性约束，实体完整性（主属性非空 ），参照完整性（外码的取值要求）和用户定义的完整性（根据某一具体应用，涉及的数据必须满足的要求）     
- 实体完整性是主属性非空    
- 参照完整性是外码的取值要求    
- 用户定义的完整性是根据某一具体应用，涉及的数据必须满足的要求   

---

- 实体完整性和参照完整性是关系模型必须满足的完整性约束条件，又被称为关系的两个不变性    
- 是由我们关系系统自动支持的   
- 用户定义的完整性是应用领域需要遵循的约束条件，体现了具体领域的语义上的约束   
- 接下来我们详细说一下，这三种完整性约束，首先我们先看实体完整性   

---
### 2.3.1 实体完整性   
- 在关系数据库中，每一个元祖应该是可以区分的，是唯一的 ，这样的约束条件，用实体完整性来进行保障   
- 我们先看一下实体完整性的规则   
- 若属性A是基本关系R的主属性，则属性A不能取空值  
- 简而言之就是主属性非空   
- 主属性的定义呢，我们在前面已经给大家讲过，候选码中的属性，我们称为是主属性   
- 那么空值是什么意思呢？ 这里所谓的空值是不知道或不存在或无意义的值，这个我们会在后面第3章空值处理中给大家详细讲解     
- 比如说我们举一个例子，学生选修关系中包括学号，课程号和成绩 其中学号和课程号为主码，则学号，课程号都是主属性，都不能取空值   
- 主码是候选码中的一个    
- 而候选码中的属性，我们称为主属性   
- 那么主码中的属性肯定也是主属性   
- 因此呢，学号，课程号为主码，那么学号和课程号都是主属性，再根据我们实体完整性的规则，学号和课程号，不能去取空值   
- 那么我们存一个学生的数据，比如说学号是2012 15121. 课程号是1，成绩是92分，       
- 这样呢，我们可以知道，一个学号是201215121的学生，选的课程号是1的这个课程，这个课程的成绩是92分，这样没有问题   
- 因为我们可以根据学号确定学生，根据课程号确定课程，根据92分我们可以知道，这个学生这个课程考了多少分    
- 但是如果我们有学号201215121，但是课程号我们取空值，成绩写92分 那么它要表达的语义就存在问题了      
- 因为我们可以根据学号确定学生，后边的只有一个92分的成绩，对应的课程是空值，那我们就不知道 这个学生是哪门课程  考了92分，这样是不符合我们实际的（**点击**）     
- 那么我们可以把成绩设置成空值吗？ 比如我们只有一个学号201215121和课程号是1，成绩这一项，我们去空值  
- 这样写的话呢，实际上，在学生刚选完课程，那么学生是没有成绩的，我们每个学生有他的学号 ，有他的所选的课程号，但是还没有考试，不存在成绩的这样 是符合实际的     
- 对于实体完整性的还需要进行一些说明   
- 实际上是一个基本表，通常对应现实世界中一个实体，也就是说，比如说我们有一个学生表，里面包含学号，姓名，性别，专业号，年龄，这个学生关系就对应于学生的集合    
- 现实世界中的实体 是可以进行区分的 他们就具有唯一的标识    
- 在学生表中呢，实际上是每一个学生他 都代表一个独立的个体，是不一样的   
- 关系模型中，以主码作为唯一的标识    
- 因此主码是不能取相同值的  也不能取空值   
- 如果有主属性取空值，那就存在一个不可标识的实体，这与我们前面所说现实世界中的实体可区分，是相互矛盾的    
- 第1个完整性呢，我们就讲到这里   
- 

---
### 2.3.2 参照完整性   
- 下面呢，我们看一下，参照完整性   
- 参照完整性包括三部分，关系间的引用和参照完整性规则，我们先看一下关系间的引用    

---

- 在模型中实体及实体间的联系都是用关系来描述的 因此可能存在着关系与关系间的引用    
- 我们呢，根据下面的具体例子来说一下，什么是关系间的引用  

---

- 比如我这里有两张表，一个是学生信息表，一个是学生选课信息表，这两张表，分别对应两种不同的关系   
- 这两个关系存在属性间的引用，学生关系引用了专业关系的主码，专业号，学生关系中的专业号的值必须确实存在，也就是专业关系中有该专业的记录，学生关系中专业号属性的取值需要参照专业关系中的专业号的取值    
- 如果学生关系中专业号取值05，这样我们在专业关系中找不到对应的取值，那么这样就出现了问题    
- 这个就是两个关系间的引用    
- 下面我们再看课本上另一个例子   

---

- 在这里有三个表，也存在着属性间的引用，    
- 学生表里面对应的是学生的信息，课程表里边对应的是课程信息，学生选课表里面对应的是学生所选课程的信息     
- 这三个关系存在哪些引用呢？    
- 我们细心观察 就会发现，学生选课关系中，引用了学生关系的主码学号和课程关系的主码课程号，同样，学生选课关系中的学号值必须是确实存在的学生的学号，即学生关系中有该学生的记录     
- 学生选课关系中的课程号，也必须是确实存在的课程号，即课程关系中有该课程的记录，换句话说学生选课关系中某些属性的取值参照其他关系中属性的取值     
- 或者说我可不可以在学生选课表，课程号属性里面我可不可以写05，呢？   
- 这样写显然是不合适的，因为我们在课程表中没有找到对应的课程号     
- 不仅两个或两个以上的关系间可以存在引用关系，同一个关系内部属性间也可以存在引用关系     

---

- 我们再看这个例子    
- 这个关系中，学号属性是主码，班长属性表示该学生所在班级的班长的学号，他引用了本关系学号属性，也就是说你是我们班的班长必须是我们班的学生，因此，班长这一列取值必须是确实存在的学生的学号     
- 这个例子就说明了，同一个关系内部属性间也可以存在引用关系   
- 通过上面三个例子我们可以知道，关系和关系之间存在着相互引用，相互制约的情况，下面我们引入外码的概念 然后给出参照完整性的定义    

---    

- 我们先看一下外码的定义    
- 设F是基本关系R的一个或一组属性 但不是关系R的码，这里的码指的是主码， KS是基本关系S的主码 如果F与KS相对应则称F是基本关系R的外码    
- 这里需要注意的是，R和S，不一定是不同的关系 可以是同一种关系，因为前面说过，同一个关系内部属性间也可以存在引用关系   
- 因为f和ks相对应，那么 他们必须定义在同一个域上，如果他们是一组属性的话，那么 他们必须定义在同一组域上   
- 外码并不一定要与相应的主码同名，当外码与相应的主码属于不同关系时，往往取相同的名字，当然如果是在同一个关系中，为了便于区分，那么我们就用不同的名字    

---  

- 下面我们根据之前讲的例子，详细的给大家讲一下  
- 在这个例子中 选修关系的学号属性与学生关系的主码学号相对应**点击**      
- 选修关系的课程号属性，与课程关系的主码课程相对应     
- 因此学号和课程号属性是选修关系的外码    
- 再看下一个例子   

---  

- 在这个例子中，班长属性与本身主码学号属性相对应  因此班长是外码     
- 学生关系既是参照关系也是被参照的关系 **点击**     
- 下面我们看一下，参照完整性规则**点击**     

---

- 参照完整性规则，就是规定外码和主码之间的引用规则的   
- 我们先看参照完整性的规则   
- 若属性或属性组f，是基本关系r的外码 它与基本关系s的主码KS相对应 则对于r中每个元组 在f上的值，在f上的值也就是外码的值  必须满足，      
- 或者取空值  
- 或者等于S中某个元组的主码 值  
- 也就是说，参照完整性规定了 ，外码的取值，要么是空值，要么等于 所对应的 S中属性的 某个元祖的值   
- 下面我们继续根据例子给大家说**点击**   

---  

- 前面我们说到的第一个例子学生关系中每个元组的专业号属性，他参照的是专业关系的主码，专业号     
- 因此他是一个外码   
- 那么它的取值，要么是空值，也就是表示尚未给学生分配专业     
- 比如说学生刚入学还没有分方向，还没有专业    
- 也有可能是非空值，如果是非空值的话，那么必须是专业关系中某个元组的专业号的值， 是表示该学生不可能分配到一个不存在的专业    
- 我们再看下一个例子**点击**   

---  

- 在选修关系中，里面的学号参照的是学生关系 的主码 学号   
- 选修关系的课程号参照的是课程关系的主码课程号     
- 因此学号和课程号，他们是选修关系的外码      
- 那么学号和课程号可能的取值有两种   
- 第1种空值  
- 但是在选修关系中，学号和课程号他们是主属性不能取空   
- 那么他们取值只有一种情况   
- 就是只能取相应被参照关系中已存在的主码值   
- 讲到这里参照完整性就讲完了   **点击**（结束）    

---

- 下面我们学习一下，用户定义得 完整性**点击**   

---


- 任何数据库系统都应该支持实体完整性和参照完整性    
- 包括我们上课用的SQL server2008，如果不满足实体完整性和参照完整性，系统会 报错   
- 用户定义完整性就是针对某一具体关系数据库的约束条件   
- 反映的是 某一具体应用所涉及的数据，必须满足的语义要求   
- 比如说学生的性别要么男，要么是女   
- 在比如说学生成绩的取值应该是0~100，不能超过这个范围    
- 再比如说后面这个例子，   
- 课程的关系中，我们除了满足实体完整性和参照完整性之外，我们还可以进行一些其他的要求   
- 比如课程号属性必须取惟一值   
- 非主属性，课程名也不能取空值  
- 因为之前主属性不可为空，非主属性是可以取空的    
- 我们可以 加上要求不能取空值        
- 关系模型应提供定义和检验，这类完整性的机制，以便统一的系统和方法处理它们，而不要由应用程系承担这一功能   
- 因为一些早期的关系数据库管理系统没有提供这种机制，因此需要开发人员 在应用程序中进行检查 给开发人员带来了一定的负担    
- 用户定义完整性的比较容易理解，我们就讲到这里**点击**   


---  

- 到现在呢，我们已经将第3节关系完整性的知识上给大家讲完了，大家课下认真看一下课本 有不懂的及时交流    






- 









 









































